# Results Export Module

## Overview

The Results Export module allows administrators to view and export admission results to Excel format. This module provides filtering capabilities by session, program, and status, along with a preview feature to review results before exporting.

## Features

### 1. Session Selection (Requirement 14.1)
- Select admission session from dropdown
- Displays all available sessions with year information
- Auto-selects first session if available

### 2. Filtering (Requirement 14.2)
- **By Session**: Filter results by admission session
- **By Program**: Filter results by specific program/major
- **By Status**: Filter by acceptance status (accepted, rejected, pending)
- Real-time filtering updates statistics and preview

### 3. Results Preview (Requirement 14.7)
- Display results in a sortable, paginated table
- Shows student information, program, score, ranking, and status
- Color-coded status tags for easy identification
- Statistics cards showing total, accepted, rejected, and pending counts

### 4. Excel Export (Requirements 14.3, 14.4, 14.5, 14.6)
- Export results to Excel file with one click
- Progress indicator during export generation
- Automatic file download with descriptive filename
- Comprehensive error handling for export failures

## API Integration

### Endpoints Used

1. **Get Sessions**
   - Endpoint: `GET /program/sessions`
   - Service: `ProgramsService.programControllerFindAllSessions()`
   - Purpose: Fetch list of admission sessions

2. **Get Programs**
   - Endpoint: `GET /program/majors`
   - Service: `ProgramsService.programControllerFindAllMajors()`
   - Purpose: Fetch list of programs for filtering

3. **Export Results**
   - Endpoint: `GET /sessions/{id}/results/export`
   - Service: `ResultsService.resultControllerExportResults(sessionId)`
   - Purpose: Generate and download Excel file with results
   - Returns: Binary Excel file (Blob)

## Component Structure

```
ResultsPage
├── Filter Configuration Card
│   ├── Session Selector
│   ├── Program Filter
│   ├── Status Filter
│   └── Action Buttons (Preview, Export, Refresh)
├── Statistics Card
│   ├── Total Results
│   ├── Accepted Count
│   ├── Rejected Count
│   └── Pending Count
├── Results Preview Card (conditional)
│   └── Results Table
│       ├── Student ID
│       ├── Full Name
│       ├── ID Card Number
│       ├── Program
│       ├── Score
│       ├── Ranking
│       └── Status
└── Information Card (when no session selected)
```

## State Management

### Local State
- `sessions`: List of admission sessions
- `programs`: List of programs/majors
- `selectedSessionId`: Currently selected session
- `selectedProgramId`: Currently selected program filter
- `selectedStatus`: Currently selected status filter
- `loading`: Loading state for data fetching
- `exporting`: Loading state for export operation
- `results`: List of result records
- `previewVisible`: Whether preview table is visible

## User Flow

1. **Initial Load**
   - Page loads and fetches sessions and programs
   - Auto-selects first session if available
   - Displays information card with instructions

2. **Filter Selection**
   - User selects session (required)
   - Optionally filters by program and/or status
   - Statistics update based on filters

3. **Preview Results**
   - User clicks "Preview Results" button
   - Results table displays with filtered data
   - Table supports sorting and pagination

4. **Export to Excel**
   - User clicks "Export to Excel" button
   - Progress indicator shows during generation
   - Excel file downloads automatically
   - Success/error message displays

## Error Handling

### Export Errors (Requirement 14.6)
- **403 Forbidden**: User lacks export_results permission
- **404 Not Found**: Session not found or no results available
- **500 Server Error**: Server error during export generation
- **Network Error**: Connection issues

All errors display user-friendly messages via Ant Design message component.

## Permissions Required

- `view_results`: View results list and preview
- `export_results`: Export results to Excel

## Notes

- Results must be generated by running the Virtual Filter first
- Export filename includes session name and current date
- Preview table supports client-side sorting and filtering
- Statistics update in real-time based on selected filters
- Mock data is used for preview until API endpoint is available

## Future Enhancements

1. Add API endpoint for fetching results list
2. Implement server-side pagination for large result sets
3. Add bulk actions (email notifications, status updates)
4. Support multiple export formats (PDF, CSV)
5. Add result comparison between sessions
6. Implement result analytics and charts
